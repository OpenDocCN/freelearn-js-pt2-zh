["```js\naddEventListener(\"load\", () => {\n  console.log(\"loaded 1\");\n});\naddEventListener(\"unload\", () => {\n  console.log(\"unloaded 1\");\n});\naddEventListener(\"load\", () => {\n  console.log(\"loaded 2\");\n});\naddEventListener(\"unload\", () => {\n  console.log(\"unloaded 2\");\n});\nconsole.log(\"Exiting...\");\n```", "```js\n$ deno run program-lifecycle/add-event-listener.js\nExiting...\nloaded 1\nloaded 2\nunloaded 1\nunloaded 2\n```", "```js\nwindow.onload = () => {\n  console.log(\"onload 1\");\n};\nwindow.onunload = () => {\n  console.log(\"onunload 1\");\n};\nwindow.onload = () => {\n  console.log(\"onload 2\");\n};\nwindow.onunload = () => {\n  console.log(\"onunload 2\");\n};\nconsole.log(\"Exiting\");\n```", "```js\n$ deno run program-lifecycle/window-on-load.js\nExiting\nonload 2\nonunload 2\n```", "```js\n    fetch(\"https://deno.land/logo.svg\")\n    ```", "```js\n    fetch(\"https://deno.land/logo.svg\")\n      .then(r =>r.blob())\n    ```", "```js\n    fetch(\"https://deno.land/logo.svg \")\n      .then(r =>r.blob())\n      .then(async (img) => {\n        const base64 = btoa(\n          await img.text()\n        )\n    });\n    ```", "```js\n    fetch(\"https://deno.land/logo.svg \")\n      .then(r =>r.blob())\n      .then(async (img) => {\n    const base64 = btoa(\n          await img.text()\n        )\n        console.log(`<html>\n    <img src=\"img/svg+xml;base64,${base64}\" />\n    </html>\n        `\n        )\n      })\n    ```", "```js\n    $ deno run --allow-net web-apis/fetch-deno-logo.js\n    <html>\n      <img src=\"data:image/svg+xml;base64,PHN2ZyBoZWlnaHQ9Ijgx My4xODQiIHdpZHRoPSI4MTMuMTUiIHhtbG5zPSJodHRwOi8vd3d3Lncz Lm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0iIzIyMiI+PHBhdGggZD0ibTM3 NC41NzUuMjA5Yy0xLjkuMi04IC45LTEzLjUgMS40LTc4LjIgOC4yLTE1 NS4yIDQxLjMtMjE4IDkzLjktMTEuNiA5LjYtMzggMzYtNDcuNiA0Ny42 LTUyIDYyLjEtODIuNCAxMzEuOC05My42IDIxNC4zLTIuNSAxOC4z\n    …\n    ```", "```js\n$ deno run --allow-net web-apis/fetch-deno-logo.js > web-apis/deno-logo.html\n```", "```js\n$ deno run --allow-net --allow-read https://deno.land/std@0.83.0/http/file_server.ts web-apis\nCheck https://deno.land/std@0.65.0/http/file_server.ts\nHTTP server listening on http://0.0.0.0:4507\n```", "```js\n    for await (const dir of Deno.readDir(\".\")) {\n      console.log(dir.name)\n    }\n    ```", "```js\n    readDir (https://doc.deno.land/builtin/stable#Deno.readDir) from the Deno namespace.As is mentioned in the documentation, it returns `AsyncInterable`, which we're looping through and printing the name of the file. As the runtime is written in TypeScript, we have very useful type completion and we know exactly what properties are present in every `dir` entry.Now, we want to get the current directory as a command-line argument.\n    ```", "```js\n    const [path = \".\"] = Deno.args;\n    for await (const dir of Deno.readDir(path)) {\n      console.log(dir.name)\n    }\n    ```", "```js\n    $ deno run --allow-read ../list-file-names.ts            \n    file-with-no-content.txt\n    .hidden-file\n    lorem-ipsum.txt\n    ```", "```js\n    padEnd so that the output is aligned. By running the program we just wrote, while in the Chapter03/Is folder (https://github.com/PacktPublishing/Deno-Web-Development/tree/master/Chapter03/ls/demo-files), we get the following output:\n\n    ```", "```js\n\n    ```", "```js\n    …\n    const [path = \".\"] = Deno.args;\n    await Deno.permissions.request({\n      name: \"read\",\n      path,\n    });\n    for await (const dir of Deno.readDir(path)) {\n    …\n    ```", "```js\n    g to the permission request command, we're granting it access to the current directory (.).We can now try to run the same program but denying the permissions this time.\n    ```", "```js\n    $ deno run --unstable list-file-names-interactive-permissions.ts .\n    Deno requests read access to \".\". Grant? [g/d (g = grant, d = deny)] d\n    error: Uncaught (in promise) PermissionDenied: read access to \".\", run again with the --allow-read flag\n        at processResponse (deno:core/core.js:223:11)\n        at Object.jsonOpAsync (deno:core/core.js:240:12)\n        at async Object.[Symbol.asyncIterator] (deno:cli/rt/30_fs.js:125:16)\n        at async list-file-names-interactive-permissions.ts:10:18\n    ```", "```js\nconst decoder = new TextDecoder()\nconst content = await Deno.readFile('./sentence.txt');\nconsole.log(decoder.decode(content))\n```", "```js\nconst content = await Deno.readFile(\"./sentence.txt\");\nawait Deno.writeFile(\"./copied-sentence.txt\", content)\n```", "```js\nawait Deno.copyFile(\"./copied-sentence.txt\", \n  \"./using-copy-command.txt\");\n```", "```js\nconst encoder = new TextEncoder();\nconst fileContents = await Deno.readFile(\"./example-log.txt \");\nconst decoder = new TextDecoder();\nconst logLines = decoder.decode(fileContents).split(\"\\n\");\nexport default function start(buffer: Deno.Buffer) {\n  setInterval(() => {\n     const randomLine = Math.floor(Math.min(Math.random() *        1000, logLines.length));\n     buffer.write(encoder.encode(logLines[randomLine]));\n  },   100)\n}\n```", "```js\n    import start from \"./logCreator.ts\";\n    const buffer = new Deno.Buffer();\n    start(buffer);\n    ```", "```js\n    …\n    start(buffer);\n    processLogs();\n    async function processLogs() {}\n    ```", "```js\n    …\n    async function processLogs() {\n      const destination = new Uint8Array(100);\n      const readBytes = await buffer.read(destination);\n      if (readBytes) {\n        // Something was read from the buffer\n      }\n    }\n    ```", "```js\n    const decoder = new TextDecoder();\n    …  \n    if (readBytes) {\n      const read = decoder.decode(destination);\n    }\n    ```", "```js\n    const decoder = new TextDecoder();\n    const encoder = new TextEncoder();\n    …  \n    if (readBytes) {\n      const read = decoder.decode(destination);\n      await Deno.stdout.write(encoder.encode(`${read}\\n`));\n    }\n    ```", "```js\n    async function processLogs() {\n      const destination = new Uint8Array(100);\n      const readBytes = await buffer.read(destination);\n      if (readBytes) {\n        …\n      }\n      setTimeout(processLogs, 10);\n    }\n    ```", "```js\nasync function processLogs() {\n  const destination = new Uint8Array(100);\n  const readBytes = await buffer.read(destination);\n  if (readBytes) {\n    const read = decoder.decode(destination);\n    if (read.includes(\"Tue\")) {\n      await Deno.stdout.write(encoder.encode(`${read}\\n`));\n    }\n  }\n  setTimeout(processLogs, 10);\n}  \n```", "```js\n$ deno run --allow-read index.ts\nTue Aug 20 17:12:05 WEST 2019\nTue Sep 17 02:19:56 WEST 2019\nTue Dec  3 14:02:01 CET 2019\nTue Jul 21 10:37:26 WEST 2020\n```", "```js\n    import { red } from \"https://deno.land/std@0.83.0/fmt/colors.ts\";\n    ```", "```js\n    const [path = \".\"] = Deno.args;\n    for await (const item of Deno.readDir(path)) {\n      if (item.isDirectory) {\n        console.log(red(item.name));\n      } else {\n        console.log(item.name);\n      }\n    }\n    ```", "```js\n    $ deno run –allow-read list-file-names-color.ts\n    file-with-no-content.txt\n    demo-folder\n    .hidden-file\n    lorem-ipsum.txt\n    ```", "```js\n    import { serve } from\n      \"https://deno.land/std@0.83.0/http/server.ts\";\n    ```", "```js\n    console.log(\"Server running at port 8080\");\n    for await (const req of serve({ port: 8080 })) {\n      req.respond({ body: \"post-it api\", status: 200 });\n    }\n    ```", "```js\n    deno run --allow-net index.ts\n    Server running at port 8080\n    ```", "```js\n    const PORT = 8080;\n    const server = serve({ port: PORT });\n    console.log(\"Server running at port\", PORT);\n    for await (const req of serve({ port: PORT })) {\n    …\n    ```", "```js\n    const PORT = 8080;\n    const HOST = \"localhost\";\n    const PROTOCOL = \"http\";\n    const server = serve({ port: PORT, hostname: HOST });\n    console.log(`Server running at ${HOST}:${PORT}`);\n    for await (const req of server) {\n      const url = new\n        URL(`${PROTOCOL}://${HOST}${req.url}`);\n      req.respond({ body: \"post-it api\", status: 200 });\n    }\n    ```", "```js\n      const pathWithMethod = `${req.method} ${url.pathname}`;\n      switch (pathWithMethod) {\n        case \"GET /api/post-its\":\n          req.respond({ body: \"list of all the post-its\",\n            status: 200 });\n          continue;\n        default:\n          req.respond({ status: 404 });\n      } \n    ```", "```js\n      const pathWithMethod = `${req.method} ${url.pathname}`\n      switch (pathWithMethod) {\n    ```", "```js\n    interface PostIt {\n      title: string,\n      id: string,\n      body: string,\n      createdAt: Date\n    }\n    ```", "```js\n    let postIts: Record<PostIt[\"id\"], PostIt> = {}\n    ```", "```js\n    let postIts: Record<PostIt[\"id\"], PostIt> = {\n      '3209ebc7-b3b4-4555-88b1-b64b33d507ab': { title: 'Read more', body: 'PacktPub books', id: 3209ebc7-b3b4-4555-88b1-b64b33d507ab ', createdAt: new Date() },\n      'a1afee4a-b078-4eff-8ca6-06b3722eee2c': { title: 'Finish book', body: 'Deno Web Development', id: '3209ebc7-b3b4-4555-88b1-b64b33d507ab ', createdAt: new Date() }\n    }\n    ```", "```js\n    case GET \"/api/post-its\":\n      req.respond({ body: \"list of all the post-its\", status:     200 });\n      const allPostIts = Object.keys(postIts).\n        reduce((allPostIts: PostIt[], postItId) => {\n            return allPostIts.concat(postIts[postItId]);\n          }, []);\n      req.respond({ body: JSON.stringify({ postIts:     allPostIts }) });\n      continue;\n    ```", "```js\n    const headers = new Headers();\n    headers.set(\"content-type\", \"application/json\");\n    const pathWithMethod = `${req.method} ${url.pathname}`\n    switch (pathWithMethod) {\n      case \"GET /api/post-its\":\n    …\n        req.respond({ body: JSON.stringify({ postIts: \n          allPostIts }) });\n        req.respond({ headers, body: JSON.stringify({ \n          postIts: allPostIts }) });\n        continue;\n    ```", "```js\n        case \"POST /api/post-its\":\n          req.respond({ status: 201 });\n          continue\n    ```", "```js\n    curl but feel free to use your favorite HTTP requests tool, you can even use a graphical client such as Postman (https://www.postman.com/).Let's make the new route do what it is supposed to. It should get a JSON payload and use that to create a new post-it.We know, by looking at the documentation of the standard library's HTTP module ([https://doc.deno.land/https/deno.land/std@0.83.0/http/server.ts#ServerRequest](mailto:https://doc.deno.land/https/deno.land/std@0.67.0/http/server.ts#ServerRequest)) that the body of the request is a *Reader* object. The documentation includes an example on how to read from it.\n    ```", "```js\n    case \"POST /api/post-its\":\n          const body = await Deno.readAll(req.body);\n          console.log(body) \n    ```", "```js\n    201 status code. If we look at our running server though, something like this is printed to the console:\n\n    ```", "```js\n\n    We previously learned that Deno uses `Uint8Array` to do all its communications with the Rust backend, and this is not an exception. However, `Uint8Array` is not what we currently want, we want the actual text of the request body. \n    ```", "```js\n    $ deno -X POST -d \"{\\\"title\\\": \\\"Buy milk\\\"}\" \n    http://localhost:8080/api/post-its\n    ```", "```js\n    {\"title\": \"Buy milk \"}\n    ```", "```js\n    const decoded = JSON.parse(new \n      TextDecoder().decode(body));\n    ```", "```js\n    import { v4 } from \n      \"https://deno.land/std/uuid/mod.ts\";\n    ```", "```js\n    case \"POST /api/post-its\":\n    …\n        const decoded = JSON.parse(new \n          TextDecoder().decode(body));\n        const id = v4.generate();\n        postIts[id] = {\n          ...decoded,\n          id,\n          createdAt: new Date()\n        }\n        req.respond({ status: 201, body:\n          JSON.stringify(postIts[id]), headers });\n    ```", "```js\n    GET request to the route that lists all the post-its to check if the record was actually inserted into the database:\n\n    ```", "```js\n\n    ```", "```js\n    resolve, and fromFileUrl methods from Deno's standard-library to get a URL that is relative to the current file.Note that we now need to run this with the `--allow-read` flag since our code is reading from the filesystem. \n    ```", "```js\n    $ deno run --allow-net --allow-read=. index.ts\n    Server running at http://0.0.0.0:8080 \n    ```"]